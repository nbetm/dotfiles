# vim: set ft=zsh :
# shellcheck disable=all

# Guard against re-sourcing
[[ -n "$_ZPROFILE_SOURCED" ]] && return
typeset -g _ZPROFILE_SOURCED=1

# PATH Configuration
if [[ $OS_NAME == "Darwin" ]]; then
    # Initiate Homebrew
    eval "$(/opt/homebrew/bin/brew shellenv)"

    # Additional Paths
    typeset -U path
    path=(
        "$XDG_BIN_HOME"
        "${XDG_DATA_HOME}/google-cloud-sdk/bin"
        "${HOMEBREW_PREFIX}/opt/coreutils/libexec/gnubin"
        "${HOMEBREW_PREFIX}/opt/curl/bin"
        "${HOMEBREW_PREFIX}/opt/findutils/libexec/gnubin"
        "${HOMEBREW_PREFIX}/opt/fzf/bin"
        "${HOMEBREW_PREFIX}/opt/gnu-indent/libexec/gnubin"
        "${HOMEBREW_PREFIX}/opt/gnu-sed/libexec/gnubin"
        "${HOMEBREW_PREFIX}/opt/gnu-tar/libexec/gnubin"
        "${HOMEBREW_PREFIX}/opt/gnu-which/libexec/gnubin"
        "${HOMEBREW_PREFIX}/opt/grep/libexec/gnubin"
        "${HOMEBREW_PREFIX}/opt/make/libexec/gnubin"
        $path
    )

    # FZF
    export FZF_SHELL_DIR="${HOMEBREW_PREFIX}/opt/fzf/shell"

elif [[ $OS_NAME = "Linux" ]]; then
    # Debian/Ubuntu: Manual package installations
    if [[ ! "$OS_DISTRO" == "nixos" ]]; then
        typeset -U path
        path=(
            "$XDG_BIN_HOME"
            "${XDG_DATA_HOME}/google-cloud-sdk/bin"
            "${HOME}/.fzf/bin"
            "/usr/libexec/docker/cli-plugins"
            $path
        )
    fi

    # FZF shell integration path (distro-specific)
    if [[ "$OS_DISTRO" == "nixos" ]]; then
        if [[ -n "${commands[fzf-share]}" ]]; then
            source "$(fzf-share)/key-bindings.zsh"
            source "$(fzf-share)/completion.zsh"
        fi
    else
        export FZF_SHELL_DIR="${HOME}/.fzf/shell"
    fi
fi

# LS_COLORS
if [[ -f "${HOME}/.dir_colors" ]]; then
    eval "$(dircolors -b "${HOME}/.dir_colors")"
fi
