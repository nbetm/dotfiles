# Prefix key
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Terminal
set -g default-terminal "tmux-256color"
set -as terminal-features ",xterm-kitty:RGB:hyperlinks:clipboard:strikethrough:usstyle:extkeys"
set -as terminal-features ",xterm-ghostty:RGB:hyperlinks:clipboard:strikethrough:usstyle:extkeys"
set -s extended-keys on
set -s extended-keys-format csi-u
set -s escape-time 0
set -g focus-events on

# Behavior
set -g base-index 1
set -g detach-on-destroy off
set -g display-time 4000
set -g history-limit 50000
set -g pane-base-index 1
set -g renumber-windows on
set -g visual-activity off
set -g visual-bell off
set -wg aggressive-resize on
set -wg automatic-rename on
set -wg clock-mode-style 24
set -wg monitor-activity on

# System
bind -N "Reload config" R source-file "$HOME/.config/tmux/tmux.conf" \; display "$HOME/.config/tmux/tmux.conf reloaded"
bind -N "Toggle activity monitoring" M set-window-option monitor-activity \; display-message "Activity monitoring #{?monitor-activity,ON,OFF}"
bind -N "Clear screen" -n C-l send-keys C-l \; clear-history

# Windows
bind -N "New window" n new-window -c "#{pane_current_path}"
bind -N "New window (after)" N new-window -a -c "#{pane_current_path}"
bind -N "New window (named)" c command-prompt -p "New-window:" "new-window -n %% -c '#{pane_current_path}'"
bind -N "New window (named, after)" C command-prompt -p "New-window:" "new-window -a -n %% -c '#{pane_current_path}'"
bind -N "Rename window" r command-prompt -p "Rename-window:" "rename-window %%"
bind -N "Next window" -r . next-window
bind -N "Previous window" -r , previous-window
bind -N "Last window" a last-window

# Panes
bind -N "Split vertical" s split-window -v -c "#{pane_current_path}"
bind -N "Split horizontal" v split-window -h -c "#{pane_current_path}"
bind -N "Toggle sync" = set synchronize-panes \; display-message "Sync #{?synchronize-panes,ON,OFF}" \; refresh-client -S
bind -N "Swap down" > swap-pane -D
bind -N "Swap up" < swap-pane -U

# Navigation (vim keys)
unbind Left
unbind Down
unbind Up
unbind Right
bind -N "Left" h select-pane -L
bind -N "Down" j select-pane -D
bind -N "Up" k select-pane -U
bind -N "Right" l select-pane -R

# Resize
bind -N "Resize left" -r H resize-pane -L 2
bind -N "Resize down" -r J resize-pane -D 2
bind -N "Resize up" -r K resize-pane -U 2
bind -N "Resize right" -r L resize-pane -R 2
bind -N "Zoom" z resize-pane -Z
bind -N "Zoom" Enter resize-pane -Z

# Copy mode
unbind \]
set -g status-keys emacs
set-window-option -g mode-keys vi
bind -N "List buffers" b list-buffers
bind -N "Paste" p paste-buffer
bind -N "Choose buffer" P choose-buffer
bind -N "Select" -T copy-mode-vi v send-keys -X begin-selection
bind -N "Select line" -T copy-mode-vi V send-keys -X select-line
bind -N "Rectangle select" -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -N "Copy" -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -N "Exit" -T copy-mode-vi q send-keys -X cancel
bind -N "Clear" -T copy-mode-vi Escape send-keys -X clear-selection

# Theme & Status
source-file "$HOME/.config/tmux/themes/nord-deep.conf"
set -g status on
set -g status-position top
set -g status-interval 2
set -g status-justify left
set -g status-right-length 100
set -g status-left-length 100
set -g status-left ""
set -g status-right "#{E:@opt_status_session}"
set -ag status-right "#{E:@opt_status_host}"
set -agF status-right "#{E:@opt_status_date_time}"

# Sessions
bind -N "Session picker" o run-shell "sesh-picker"
bind -N "Last session" Tab switch-client -l
bind -N "Previous session" -r \{ switch-client -p
bind -N "Next session" -r \} switch-client -n
bind -N "Kill session" X confirm-before -p "Kill session #S? (y/n)" kill-session

# Popups
bind -N "Floating pane" f run-shell "tmux-toggle-pane float"
bind -N "Side pane" \\ run-shell "tmux-toggle-pane"
bind -N "Man page" m command-prompt -p "Open man page for:" "popup -d '#{pane_current_path}' -xC -yC -w80% -h80% -E 'man %%'"
bind -N "Lazygit" g popup -d "#{pane_current_path}" -xC -yC -w80% -h80% -E "lazygit"
bind -N "Open URL" u run-shell "tmux-open-url"
